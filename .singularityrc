# encoding: utf-8

batch :test do
  rubocop
  bootcoveralls { pr ENV.fetch('PULL', nil) } if flag? 'coveralls'
  rspec
end

batch :callback_integration do
  rubocop
  on_fail { fail 'fail callback' }
  on_error { fail 'error callback' }
  on_success { rspec }
  always { puts 'Callback Integrations seem ok!' }
end

batch :ci do
  shelltask { command 'bundle install --path ./vendor' }
  shelltask { command 'bundle exec singularity_runner batch test --flags coveralls' }
  shelltask { command 'bundle exec singularity_runner batch callback_integration' }
end

invoke_batch :test
